<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.admin.dao.RevenueMangementDAO">

	<select id="selectEprodRevenue" resultType="int" parameterType="map">
	    SELECT 
	    	NVL(SUM(AMOUNT * 0.05),0) AS EPROD_MONTH
		FROM TB_EPROD_PAYMENT
		WHERE epay_yn = 'Y'
	    AND TO_CHAR(epay_date,'YYYY') = #{year}
	    AND TO_CHAR(epay_date,'MM') = #{month}
	    AND epay_num NOT IN (SELECT epay_num FROM tb_eprod_refund)
	</select>
	
	<select id="selectWorkRevenue" resultType="int" parameterType="map">
		SELECT 
			NVL(SUM(WPAY_AMOUNT),0) AS WORK_MONTH
		FROM TB_WORK_PAYMENT
		WHERE WPAY_YN = 'Y'
		AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
		AND TO_CHAR(WPAY_DATE,'MM') = #{month}
		AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)
	</select>
	
	<select id="selectMonthRevenue" resultType="kr.or.ddit.admin.vo.RevenueVO" parameterType="map">
		SELECT
			(SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '01' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH01
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '02' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH02
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '03' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH03
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '04' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH04
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '05' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH05
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '06' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH06
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '07' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH07
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '08' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH08
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '09' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH09
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '10' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH10
			
			, (SELECT 
			    	NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '11' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH11
			, (SELECT 
			   		NVL(SUM(AMOUNT * 0.05),0) 
				FROM TB_EPROD_PAYMENT 
				WHERE EPAY_YN = 'Y' 
				AND TO_CHAR(EPAY_DATE,'YYYY') = #{year} 
				AND TO_CHAR(EPAY_DATE,'MM') = '12' 
				AND EPAY_NUM NOT IN (SELECT EPAY_NUM FROM TB_EPROD_REFUND)) AS EPROD_MONTH12
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '01'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH01
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '02'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH02
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '03'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH03
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '04'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH04
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '05'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH05
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '06'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH06
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '07'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH07
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '08'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH08
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '09'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH09
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '10'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH10
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '11'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH11
			, (SELECT 
			        NVL(SUM(WPAY_AMOUNT),0) 
			    FROM TB_WORK_PAYMENT
			    WHERE WPAY_YN = 'Y'
			    AND TO_CHAR(WPAY_DATE,'YYYY') = #{year}
			    AND TO_CHAR(WPAY_DATE,'MM') = '12'
			    AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)) AS WORK_MONTH12
		FROM DUAL
	</select>
	
	<select id="selectExpertTermRevenue" resultType="RevenueVO" parameterType="map">
		SELECT 
			TO_CHAR(EPAY_DATE,'YYYY.MM.DD') AS EPAY_DATE
			, AMOUNT AS EPROD_REVENUE
			, SUM(AMOUNT) OVER (ORDER BY ROWID) AS ACCUM_REVENUE
		FROM TB_EPROD_PAYMENT
		WHERE EPAY_YN = 'Y'
		AND EPAY_NUM NOT IN(SELECT EPAY_NUM FROM TB_EPROD_REFUND)
		AND EPAY_DATE BETWEEN #{startDate} AND #{endDate}
	</select>
	
	<select id="selectProjcetTermRevenue" resultType="RevenueVO" parameterType="map">
		SELECT 
			TO_CHAR(WPAY_DATE,'YYYY.MM.DD')  AS WPAY_DATE
			, WPAY_AMOUNT AS WORK_REVENUE
			, SUM(WPAY_AMOUNT) OVER (ORDER BY ROWID) AS ACCUM_REVENUE
		FROM TB_WORK_PAYMENT
		WHERE WPAY_YN = 'Y'
		AND WPAY_NUM NOT IN(SELECT WPAY_NUM FROM TB_WORK_REFUND)
        AND WPAY_DATE BETWEEN #{startDate} AND #{endDate}
	</select>
</mapper>