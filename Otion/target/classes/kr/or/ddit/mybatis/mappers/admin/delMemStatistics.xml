<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.admin.dao.MemberManagementDAO">
	<select id="getDelStatistics" resultType="kr.or.ddit.admin.vo.DelMemVO" parameterType="String">
		SELECT
			(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '01') AS DEL_MEM01
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '02') AS DEL_MEM02
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '03') AS DEL_MEM03
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '04') AS DEL_MEM04
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '05') AS DEL_MEM05
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '06') AS DEL_MEM06
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '07') AS DEL_MEM07
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '08') AS DEL_MEM08
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '09') AS DEL_MEM09
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '10') AS DEL_MEM10
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '11') AS DEL_MEM11
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND TO_CHAR(DEL_DATE, 'MM') = '12') AS DEL_MEM12
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER A
			INNER JOIN TB_COM_CODE B ON(A.DEL_CODE = B.COM_CODE)
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND B.COM_CODE = 'reason1') AS REASON1
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER A
			INNER JOIN TB_COM_CODE B ON(A.DEL_CODE = B.COM_CODE)
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND B.COM_CODE = 'reason2') AS REASON2
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER A
			INNER JOIN TB_COM_CODE B ON(A.DEL_CODE = B.COM_CODE)
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND B.COM_CODE = 'reason3') AS REASON3
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER A
			INNER JOIN TB_COM_CODE B ON(A.DEL_CODE = B.COM_CODE)
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}
			AND B.COM_CODE = 'reason4') AS REASON4
			,(SELECT COUNT(*)
			FROM TB_DELMEMBER A
			INNER JOIN TB_COM_CODE B ON(A.DEL_CODE = B.COM_CODE)
			WHERE TO_CHAR(DEL_DATE, 'YYYY') = #{year}) AS TOTAL
		FROM DUAL
	</select>

</mapper>