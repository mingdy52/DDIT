<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.common.dao.NewsDAO">
	<insert id="insertNews" parameterType="kr.or.ddit.common.vo.NewsVO">
		<selectKey resultType="string" keyProperty="newsNum" order="BEFORE">
			SELECT FN_CREATE_NUM(TO_CHAR(SYSDATE,'YYMMDD'), 'TB_NEWS', 'NEWS_NUM', UPPER('NEWS'))
			FROM DUAL
		</selectKey>
		
		INSERT INTO tb_news (
		    NEWS_NUM,
		    RECEIVER_ID,
		    NEWS_MSG_CODE,
		    NEWS_ID,
		    POST_ID
		) VALUES (
		    #{newsNum,jdbcType=VARCHAR}
		    , #{receiverId,jdbcType=VARCHAR}
		    , #{newsMsgCode,jdbcType=VARCHAR}
		    , #{newsId,jdbcType=VARCHAR}
		    , #{postId,jdbcType=VARCHAR}
		)
	</insert>
	
	<select id="selectMyNews" parameterType="NewsVO" resultType="NewsVO">
	 SELECT
		    NEWS_NUM,
		    RECEIVER_ID,
		    NEWS_MSG_CODE,
		    NEWS_OPEN_YN,
		    TO_CHAR(NEWS_DATE,'YYYY.MM.DD  HH24:MI') AS NEWS_DATE,
		    NEWS_ID,
		    POST_ID,
		    B.COM_CODE_NM
    FROM TB_NEWS A, TB_COM_CODE B
	WHERE RECEIVER_ID=#{receiverId,jdbcType=VARCHAR}
      AND A.NEWS_MSG_CODE=B.COM_CODE
      AND A.NEWS_OPEN_YN = 'N'
      ORDER BY NEWS_NUM DESC
	</select>
	
	<update id="updateNewsChk">
		 UPDATE TB_NEWS
		   SET 
		 NEWS_OPEN_YN = 'Y'
		 WHERE NEWS_ID = #{newsId,jdbcType=VARCHAR}
		   AND RECEIVER_ID=#{receiverId,jdbcType=VARCHAR}
	</update>
</mapper>